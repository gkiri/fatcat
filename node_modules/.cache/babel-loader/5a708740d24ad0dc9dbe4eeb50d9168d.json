{"ast":null,"code":"import _regeneratorRuntime from\"/home/gude/Gkiran_Area/wbst/fatcat/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/gude/Gkiran_Area/wbst/fatcat/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import*as anchor from\"@project-serum/anchor\";import{MintLayout,TOKEN_PROGRAM_ID,Token}from\"@solana/spl-token\";export var CANDY_MACHINE_PROGRAM=new anchor.web3.PublicKey(\"cndyAnrLdpjq1Ssp1z8xxDsB8dxe7u4HL5Nxi2K5WXZ\");var SPL_ASSOCIATED_TOKEN_ACCOUNT_PROGRAM_ID=new anchor.web3.PublicKey(\"ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL\");var TOKEN_METADATA_PROGRAM_ID=new anchor.web3.PublicKey(\"metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s\");export var awaitTransactionSignatureConfirmation=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(txid,timeout,connection){var commitment,queryStatus,done,status,subId,_args3=arguments;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:commitment=_args3.length>3&&_args3[3]!==undefined?_args3[3]:\"recent\";queryStatus=_args3.length>4&&_args3[4]!==undefined?_args3[4]:false;done=false;status={slot:0,confirmations:0,err:null};subId=0;_context3.next=7;return new Promise(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(resolve,reject){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:setTimeout(function(){if(done){return;}done=true;console.log(\"Rejecting for timeout...\");reject({timeout:true});},timeout);try{subId=connection.onSignature(txid,function(result,context){done=true;status={err:result.err,slot:context.slot,confirmations:0};if(result.err){console.log(\"Rejected via websocket\",result.err);reject(status);}else{console.log(\"Resolved via websocket\",result);resolve(status);}},commitment);}catch(e){done=true;console.error(\"WS error in setup\",txid,e);}case 2:if(!(!done&&queryStatus)){_context2.next=8;break;}// eslint-disable-next-line no-loop-func\n_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var signatureStatuses;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return connection.getSignatureStatuses([txid]);case 3:signatureStatuses=_context.sent;status=signatureStatuses&&signatureStatuses.value[0];if(!done){if(!status){console.log(\"REST null result for\",txid,status);}else if(status.err){console.log(\"REST error for\",txid,status);done=true;reject(status.err);}else if(!status.confirmations){console.log(\"REST no confirmations for\",txid,status);}else{console.log(\"REST confirmation for\",txid,status);done=true;resolve(status);}}_context.next=11;break;case 8:_context.prev=8;_context.t0=_context[\"catch\"](0);if(!done){console.log(\"REST connection error: txid\",txid,_context.t0);}case 11:case\"end\":return _context.stop();}}},_callee,null,[[0,8]]);}))();_context2.next=6;return sleep(2000);case 6:_context2.next=2;break;case 8:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x4,_x5){return _ref2.apply(this,arguments);};}());case 7:status=_context3.sent;//@ts-ignore\nif(connection._signatureSubscriptions[subId]){connection.removeSignatureListener(subId);}done=true;console.log(\"Returning status\",status);return _context3.abrupt(\"return\",status);case 12:case\"end\":return _context3.stop();}}},_callee3);}));return function awaitTransactionSignatureConfirmation(_x,_x2,_x3){return _ref.apply(this,arguments);};}();/* export */var createAssociatedTokenAccountInstruction=function createAssociatedTokenAccountInstruction(associatedTokenAddress,payer,walletAddress,splTokenMintAddress){var keys=[{pubkey:payer,isSigner:true,isWritable:true},{pubkey:associatedTokenAddress,isSigner:false,isWritable:true},{pubkey:walletAddress,isSigner:false,isWritable:false},{pubkey:splTokenMintAddress,isSigner:false,isWritable:false},{pubkey:anchor.web3.SystemProgram.programId,isSigner:false,isWritable:false},{pubkey:TOKEN_PROGRAM_ID,isSigner:false,isWritable:false},{pubkey:anchor.web3.SYSVAR_RENT_PUBKEY,isSigner:false,isWritable:false}];return new anchor.web3.TransactionInstruction({keys:keys,programId:SPL_ASSOCIATED_TOKEN_ACCOUNT_PROGRAM_ID,data:Buffer.from([])});};export var getCandyMachineState=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(anchorWallet,candyMachineId,connection){var provider,idl,program,candyMachine,state,itemsAvailable,itemsRedeemed,itemsRemaining,goLiveDate;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:provider=new anchor.Provider(connection,anchorWallet,{preflightCommitment:\"recent\"});_context4.next=3;return anchor.Program.fetchIdl(CANDY_MACHINE_PROGRAM,provider);case 3:idl=_context4.sent;program=new anchor.Program(idl,CANDY_MACHINE_PROGRAM,provider);candyMachine={id:candyMachineId,connection:connection,program:program};_context4.next=8;return program.account.candyMachine.fetch(candyMachineId);case 8:state=_context4.sent;itemsAvailable=state.data.itemsAvailable.toNumber();itemsRedeemed=state.itemsRedeemed.toNumber();itemsRemaining=itemsAvailable-itemsRedeemed;goLiveDate=state.data.goLiveDate.toNumber();goLiveDate=new Date(goLiveDate*1000);return _context4.abrupt(\"return\",{candyMachine:candyMachine,itemsAvailable:itemsAvailable,itemsRedeemed:itemsRedeemed,itemsRemaining:itemsRemaining,goLiveDate:goLiveDate});case 15:case\"end\":return _context4.stop();}}},_callee4);}));return function getCandyMachineState(_x6,_x7,_x8){return _ref4.apply(this,arguments);};}();var getMasterEdition=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(mint){return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.next=2;return anchor.web3.PublicKey.findProgramAddress([Buffer.from(\"metadata\"),TOKEN_METADATA_PROGRAM_ID.toBuffer(),mint.toBuffer(),Buffer.from(\"edition\")],TOKEN_METADATA_PROGRAM_ID);case 2:return _context5.abrupt(\"return\",_context5.sent[0]);case 3:case\"end\":return _context5.stop();}}},_callee5);}));return function getMasterEdition(_x9){return _ref5.apply(this,arguments);};}();var getMetadata=/*#__PURE__*/function(){var _ref6=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(mint){return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:_context6.next=2;return anchor.web3.PublicKey.findProgramAddress([Buffer.from(\"metadata\"),TOKEN_METADATA_PROGRAM_ID.toBuffer(),mint.toBuffer()],TOKEN_METADATA_PROGRAM_ID);case 2:return _context6.abrupt(\"return\",_context6.sent[0]);case 3:case\"end\":return _context6.stop();}}},_callee6);}));return function getMetadata(_x10){return _ref6.apply(this,arguments);};}();var getTokenWallet=/*#__PURE__*/function(){var _ref7=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee7(wallet,mint){return _regeneratorRuntime.wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:_context7.next=2;return anchor.web3.PublicKey.findProgramAddress([wallet.toBuffer(),TOKEN_PROGRAM_ID.toBuffer(),mint.toBuffer()],SPL_ASSOCIATED_TOKEN_ACCOUNT_PROGRAM_ID);case 2:return _context7.abrupt(\"return\",_context7.sent[0]);case 3:case\"end\":return _context7.stop();}}},_callee7);}));return function getTokenWallet(_x11,_x12){return _ref7.apply(this,arguments);};}();export var mintOneToken=/*#__PURE__*/function(){var _ref8=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee8(candyMachine,config,payer,treasury){var mint,token,connection,program,metadata,masterEdition,rent;return _regeneratorRuntime.wrap(function _callee8$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:mint=anchor.web3.Keypair.generate();_context8.next=3;return getTokenWallet(payer,mint.publicKey);case 3:token=_context8.sent;connection=candyMachine.connection,program=candyMachine.program;_context8.next=7;return getMetadata(mint.publicKey);case 7:metadata=_context8.sent;_context8.next=10;return getMasterEdition(mint.publicKey);case 10:masterEdition=_context8.sent;_context8.next=13;return connection.getMinimumBalanceForRentExemption(MintLayout.span);case 13:rent=_context8.sent;_context8.next=16;return program.rpc.mintNft({accounts:{config:config,candyMachine:candyMachine.id,payer:payer,wallet:treasury,mint:mint.publicKey,metadata:metadata,masterEdition:masterEdition,mintAuthority:payer,updateAuthority:payer,tokenMetadataProgram:TOKEN_METADATA_PROGRAM_ID,tokenProgram:TOKEN_PROGRAM_ID,systemProgram:anchor.web3.SystemProgram.programId,rent:anchor.web3.SYSVAR_RENT_PUBKEY,clock:anchor.web3.SYSVAR_CLOCK_PUBKEY},signers:[mint],instructions:[anchor.web3.SystemProgram.createAccount({fromPubkey:payer,newAccountPubkey:mint.publicKey,space:MintLayout.span,lamports:rent,programId:TOKEN_PROGRAM_ID}),Token.createInitMintInstruction(TOKEN_PROGRAM_ID,mint.publicKey,0,payer,payer),createAssociatedTokenAccountInstruction(token,payer,payer,mint.publicKey),Token.createMintToInstruction(TOKEN_PROGRAM_ID,mint.publicKey,token,payer,[],1)]});case 16:return _context8.abrupt(\"return\",_context8.sent);case 17:case\"end\":return _context8.stop();}}},_callee8);}));return function mintOneToken(_x13,_x14,_x15,_x16){return _ref8.apply(this,arguments);};}();export var shortenAddress=function shortenAddress(address){var chars=arguments.length>1&&arguments[1]!==undefined?arguments[1]:4;return\"\".concat(address.slice(0,chars),\"...\").concat(address.slice(-chars));};var sleep=function sleep(ms){return new Promise(function(resolve){return setTimeout(resolve,ms);});};","map":{"version":3,"sources":["/home/gude/Gkiran_Area/wbst/fatcat/src/candy-machine.ts"],"names":["anchor","MintLayout","TOKEN_PROGRAM_ID","Token","CANDY_MACHINE_PROGRAM","web3","PublicKey","SPL_ASSOCIATED_TOKEN_ACCOUNT_PROGRAM_ID","TOKEN_METADATA_PROGRAM_ID","awaitTransactionSignatureConfirmation","txid","timeout","connection","commitment","queryStatus","done","status","slot","confirmations","err","subId","Promise","resolve","reject","setTimeout","console","log","onSignature","result","context","e","error","getSignatureStatuses","signatureStatuses","value","sleep","_signatureSubscriptions","removeSignatureListener","createAssociatedTokenAccountInstruction","associatedTokenAddress","payer","walletAddress","splTokenMintAddress","keys","pubkey","isSigner","isWritable","SystemProgram","programId","SYSVAR_RENT_PUBKEY","TransactionInstruction","data","Buffer","from","getCandyMachineState","anchorWallet","candyMachineId","provider","Provider","preflightCommitment","Program","fetchIdl","idl","program","candyMachine","id","account","fetch","state","itemsAvailable","toNumber","itemsRedeemed","itemsRemaining","goLiveDate","Date","getMasterEdition","mint","findProgramAddress","toBuffer","getMetadata","getTokenWallet","wallet","mintOneToken","config","treasury","Keypair","generate","publicKey","token","metadata","masterEdition","getMinimumBalanceForRentExemption","span","rent","rpc","mintNft","accounts","mintAuthority","updateAuthority","tokenMetadataProgram","tokenProgram","systemProgram","clock","SYSVAR_CLOCK_PUBKEY","signers","instructions","createAccount","fromPubkey","newAccountPubkey","space","lamports","createInitMintInstruction","createMintToInstruction","shortenAddress","address","chars","slice","ms"],"mappings":"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","sourcesContent":["import * as anchor from \"@project-serum/anchor\";\n\nimport {\n  MintLayout,\n  TOKEN_PROGRAM_ID,\n  Token,\n} from \"@solana/spl-token\";\n\nexport const CANDY_MACHINE_PROGRAM = new anchor.web3.PublicKey(\n  \"cndyAnrLdpjq1Ssp1z8xxDsB8dxe7u4HL5Nxi2K5WXZ\"\n);\n\nconst SPL_ASSOCIATED_TOKEN_ACCOUNT_PROGRAM_ID = new anchor.web3.PublicKey(\n  \"ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL\"\n);\n\nconst TOKEN_METADATA_PROGRAM_ID = new anchor.web3.PublicKey(\n  \"metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s\"\n);\n\nexport interface CandyMachine {\n  id: anchor.web3.PublicKey,\n  connection: anchor.web3.Connection;\n  program: anchor.Program;\n}\n\ninterface CandyMachineState {\n  candyMachine: CandyMachine;\n  itemsAvailable: number;\n  itemsRedeemed: number;\n  itemsRemaining: number;\n  goLiveDate: Date,\n}\n\nexport const awaitTransactionSignatureConfirmation = async (\n  txid: anchor.web3.TransactionSignature,\n  timeout: number,\n  connection: anchor.web3.Connection,\n  commitment: anchor.web3.Commitment = \"recent\",\n  queryStatus = false\n): Promise<anchor.web3.SignatureStatus | null | void> => {\n  let done = false;\n  let status: anchor.web3.SignatureStatus | null | void = {\n    slot: 0,\n    confirmations: 0,\n    err: null,\n  };\n  let subId = 0;\n  status = await new Promise(async (resolve, reject) => {\n    setTimeout(() => {\n      if (done) {\n        return;\n      }\n      done = true;\n      console.log(\"Rejecting for timeout...\");\n      reject({ timeout: true });\n    }, timeout);\n    try {\n      subId = connection.onSignature(\n        txid,\n        (result: any, context: any) => {\n          done = true;\n          status = {\n            err: result.err,\n            slot: context.slot,\n            confirmations: 0,\n          };\n          if (result.err) {\n            console.log(\"Rejected via websocket\", result.err);\n            reject(status);\n          } else {\n            console.log(\"Resolved via websocket\", result);\n            resolve(status);\n          }\n        },\n        commitment\n      );\n    } catch (e) {\n      done = true;\n      console.error(\"WS error in setup\", txid, e);\n    }\n    while (!done && queryStatus) {\n      // eslint-disable-next-line no-loop-func\n      (async () => {\n        try {\n          const signatureStatuses = await connection.getSignatureStatuses([\n            txid,\n          ]);\n          status = signatureStatuses && signatureStatuses.value[0];\n          if (!done) {\n            if (!status) {\n              console.log(\"REST null result for\", txid, status);\n            } else if (status.err) {\n              console.log(\"REST error for\", txid, status);\n              done = true;\n              reject(status.err);\n            } else if (!status.confirmations) {\n              console.log(\"REST no confirmations for\", txid, status);\n            } else {\n              console.log(\"REST confirmation for\", txid, status);\n              done = true;\n              resolve(status);\n            }\n          }\n        } catch (e) {\n          if (!done) {\n            console.log(\"REST connection error: txid\", txid, e);\n          }\n        }\n      })();\n      await sleep(2000);\n    }\n  });\n\n  //@ts-ignore\n  if (connection._signatureSubscriptions[subId]) {\n    connection.removeSignatureListener(subId);\n  }\n  done = true;\n  console.log(\"Returning status\", status);\n  return status;\n}\n\n/* export */ const createAssociatedTokenAccountInstruction = (\n  associatedTokenAddress: anchor.web3.PublicKey,\n  payer: anchor.web3.PublicKey,\n  walletAddress: anchor.web3.PublicKey,\n  splTokenMintAddress: anchor.web3.PublicKey\n) => {\n  const keys = [\n    { pubkey: payer, isSigner: true, isWritable: true },\n    { pubkey: associatedTokenAddress, isSigner: false, isWritable: true },\n    { pubkey: walletAddress, isSigner: false, isWritable: false },\n    { pubkey: splTokenMintAddress, isSigner: false, isWritable: false },\n    {\n      pubkey: anchor.web3.SystemProgram.programId,\n      isSigner: false,\n      isWritable: false,\n    },\n    { pubkey: TOKEN_PROGRAM_ID, isSigner: false, isWritable: false },\n    {\n      pubkey: anchor.web3.SYSVAR_RENT_PUBKEY,\n      isSigner: false,\n      isWritable: false,\n    },\n  ];\n  return new anchor.web3.TransactionInstruction({\n    keys,\n    programId: SPL_ASSOCIATED_TOKEN_ACCOUNT_PROGRAM_ID,\n    data: Buffer.from([]),\n  });\n}\n\nexport const getCandyMachineState = async (\n  anchorWallet: anchor.Wallet,\n  candyMachineId: anchor.web3.PublicKey,\n  connection: anchor.web3.Connection,\n): Promise<CandyMachineState> => {\n  const provider = new anchor.Provider(connection, anchorWallet, {\n    preflightCommitment: \"recent\",\n  });\n\n  const idl = await anchor.Program.fetchIdl(\n    CANDY_MACHINE_PROGRAM,\n    provider\n  );\n\n  const program = new anchor.Program(idl, CANDY_MACHINE_PROGRAM, provider);\n  const candyMachine = {\n    id: candyMachineId,\n    connection,\n    program,\n  }\n\n  const state: any = await program.account.candyMachine.fetch(candyMachineId);\n  const itemsAvailable = state.data.itemsAvailable.toNumber();\n  const itemsRedeemed = state.itemsRedeemed.toNumber();\n  const itemsRemaining = itemsAvailable - itemsRedeemed;\n\n  let goLiveDate = state.data.goLiveDate.toNumber();\n  goLiveDate = new Date(goLiveDate * 1000);\n\n  return {\n    candyMachine,\n    itemsAvailable,\n    itemsRedeemed,\n    itemsRemaining,\n    goLiveDate,\n  };\n}\n\nconst getMasterEdition = async (\n  mint: anchor.web3.PublicKey\n): Promise<anchor.web3.PublicKey> => {\n  return (\n    await anchor.web3.PublicKey.findProgramAddress(\n      [\n        Buffer.from(\"metadata\"),\n        TOKEN_METADATA_PROGRAM_ID.toBuffer(),\n        mint.toBuffer(),\n        Buffer.from(\"edition\"),\n      ],\n      TOKEN_METADATA_PROGRAM_ID\n    )\n  )[0];\n};\n\nconst getMetadata = async (\n  mint: anchor.web3.PublicKey\n): Promise<anchor.web3.PublicKey> => {\n  return (\n    await anchor.web3.PublicKey.findProgramAddress(\n      [\n        Buffer.from(\"metadata\"),\n        TOKEN_METADATA_PROGRAM_ID.toBuffer(),\n        mint.toBuffer(),\n      ],\n      TOKEN_METADATA_PROGRAM_ID\n    )\n  )[0];\n};\n\nconst getTokenWallet = async (\n  wallet: anchor.web3.PublicKey,\n  mint: anchor.web3.PublicKey\n) => {\n  return (\n    await anchor.web3.PublicKey.findProgramAddress(\n      [wallet.toBuffer(), TOKEN_PROGRAM_ID.toBuffer(), mint.toBuffer()],\n      SPL_ASSOCIATED_TOKEN_ACCOUNT_PROGRAM_ID\n    )\n  )[0];\n};\n\nexport const mintOneToken = async (\n  candyMachine: CandyMachine,\n  config: anchor.web3.PublicKey, // feels like this should be part of candyMachine?\n  payer: anchor.web3.PublicKey,\n  treasury: anchor.web3.PublicKey,\n): Promise<string> => {\n  const mint = anchor.web3.Keypair.generate();\n  const token = await getTokenWallet(payer, mint.publicKey);\n  const { connection, program } = candyMachine;\n  const metadata = await getMetadata(mint.publicKey);\n  const masterEdition = await getMasterEdition(mint.publicKey);\n\n  const rent = await connection.getMinimumBalanceForRentExemption(\n    MintLayout.span\n  );\n\n  return await program.rpc.mintNft({\n    accounts: {\n      config,\n      candyMachine: candyMachine.id,\n      payer: payer,\n      wallet: treasury,\n      mint: mint.publicKey,\n      metadata,\n      masterEdition,\n      mintAuthority: payer,\n      updateAuthority: payer,\n      tokenMetadataProgram: TOKEN_METADATA_PROGRAM_ID,\n      tokenProgram: TOKEN_PROGRAM_ID,\n      systemProgram: anchor.web3.SystemProgram.programId,\n      rent: anchor.web3.SYSVAR_RENT_PUBKEY,\n      clock: anchor.web3.SYSVAR_CLOCK_PUBKEY,\n    },\n    signers: [mint],\n    instructions: [\n      anchor.web3.SystemProgram.createAccount({\n        fromPubkey: payer,\n        newAccountPubkey: mint.publicKey,\n        space: MintLayout.span,\n        lamports: rent,\n        programId: TOKEN_PROGRAM_ID,\n      }),\n      Token.createInitMintInstruction(\n        TOKEN_PROGRAM_ID,\n        mint.publicKey,\n        0,\n        payer,\n        payer\n      ),\n      createAssociatedTokenAccountInstruction(\n        token,\n        payer,\n        payer,\n        mint.publicKey\n      ),\n      Token.createMintToInstruction(\n        TOKEN_PROGRAM_ID,\n        mint.publicKey,\n        token,\n        payer,\n        [],\n        1\n      ),\n    ],\n  });\n}\n\nexport const shortenAddress = (address: string, chars = 4): string => {\n  return `${address.slice(0, chars)}...${address.slice(-chars)}`;\n};\n\nconst sleep = (ms: number): Promise<void> => {\n  return new Promise((resolve) => setTimeout(resolve, ms));\n}"]},"metadata":{},"sourceType":"module"}